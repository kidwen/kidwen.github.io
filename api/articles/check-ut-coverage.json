{"title":"检查提交文件的单元测试覆盖率","uid":"0e3cff53af89b6890eddd1f859498aa3","slug":"check-ut-coverage","date":"2025-11-17T06:53:39.229Z","updated":"2025-11-17T06:53:46.270Z","comments":true,"path":"api/articles/check-ut-coverage.json","keywords":null,"cover":"https://image.kidwen.top/api/cfile/AgACAgUAAyEGAASHUuUOAANKaRrTH32jBcWm3XI4O128juN0KEIAAoQLaxttb9lUIenVsKLDCDIBAAMCAAN4AAM2BA","content":"<p>单元测试作为项目中不可或缺的一部分，无论是Angular、React还是Vue都有其默认的单元测试框架，这里就不讨论该使用哪个框架以及框架的优缺点。本文聚焦于如何通过Node脚本在代码提交时检测开发者是否将项目中的单元测试覆盖率达到要求的标准。本文涉及到的框架/技术点 <code>Angular</code>(演示示例) + <code>husky</code>(必须)+<code>git</code>(必须)+<code>karma</code>(演示示例) + <code>node</code>(必须)。</p>\n<h2 id=\"初始化karma配置\">初始化karma配置</h2>\n<p>在<code>karma.conf.js</code>文件中配置生成的单元测试报告目录地址。此时如果执行<code>ng test --code-coverage --watch=false</code>则会生成测试报告。</p>\n<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#79B8FF\">module</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#79B8FF\">exports</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> function</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">config</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  config.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(&#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    coverageReporter: &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      dir: </span><span style=\"color:#B392F0\">require</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"path\"</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">join</span><span style=\"color:#E1E4E8\">(__dirname, </span><span style=\"color:#9ECBFF\">\"./coverage/projectName\"</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      include: [</span><span style=\"color:#9ECBFF\">\"src/app/pages/**\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"src/app/services/**\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">\"src/app/shared/**\"</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      subdir: </span><span style=\"color:#9ECBFF\">\".\"</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">      // 生成json格式的单元测试覆盖率报告</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      reporters: [&#123; type: </span><span style=\"color:#9ECBFF\">\"html\"</span><span style=\"color:#E1E4E8\"> &#125;, &#123; type: </span><span style=\"color:#9ECBFF\">'lcovonly'</span><span style=\"color:#E1E4E8\"> &#125;, &#123; type: </span><span style=\"color:#9ECBFF\">\"text-summary\"</span><span style=\"color:#E1E4E8\"> &#125;, &#123; type: </span><span style=\"color:#9ECBFF\">\"json-summary\"</span><span style=\"color:#E1E4E8\"> &#125;],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125;,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 已忽略其他配置项</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;;</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"node脚本检测覆盖率\">node脚本检测覆盖率</h2>\n<p>实现思路为：</p>\n<ul>\n<li>读取单元测试覆盖率文件内容；</li>\n<li>根据git提交的文件查找对应单测文件覆盖率；</li>\n<li>当覆盖率不足时提示报错并阻止提交；</li>\n</ul>\n<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> fs </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> require</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'fs'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> execSync </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> require</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'child_process'</span><span style=\"color:#E1E4E8\">).execSync;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> report </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> fs.</span><span style=\"color:#B392F0\">readFileSync</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'coverage/projectName/coverage-summary.json'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'utf8'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 获取 staged 文件列表</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> getGitStagedFiles</span><span style=\"color:#E1E4E8\"> () &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  try</span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    var</span><span style=\"color:#E1E4E8\"> result </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> execSync</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'git diff --name-only --cached'</span><span style=\"color:#E1E4E8\">, &#123; encoding: </span><span style=\"color:#9ECBFF\">'utf8'</span><span style=\"color:#E1E4E8\"> &#125;);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> result.</span><span style=\"color:#B392F0\">trim</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">split</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\n</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">filter</span><span style=\"color:#E1E4E8\">(Boolean);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125; </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> stagedFiles </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> getGitStagedFiles</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> lowCoverageFiles </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> [];</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> i </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">; i </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\"> stagedFiles.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">; i</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> filePath </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> stagedFiles[i];</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // 这里只检测ts文件，可根据实际需求增加判断</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">filePath.</span><span style=\"color:#B392F0\">endsWith</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'.ts'</span><span style=\"color:#E1E4E8\">)) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    continue</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> fileAbsolutePath </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> require</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"path\"</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">join</span><span style=\"color:#E1E4E8\">(process.</span><span style=\"color:#B392F0\">cwd</span><span style=\"color:#E1E4E8\">(), filePath);</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // 这里替换.ts为.spec.ts并判断单测文件是否存在，如果不存在单元测试文件可以跳过也可以加入lowCoverageFiles中，按照项目要求调整！！！</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> specFileAbsolutePath </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> require</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">\"path\"</span><span style=\"color:#E1E4E8\">).</span><span style=\"color:#B392F0\">join</span><span style=\"color:#E1E4E8\">(process.</span><span style=\"color:#B392F0\">cwd</span><span style=\"color:#E1E4E8\">(), filePath.</span><span style=\"color:#B392F0\">replace</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'.ts'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'.spec.ts'</span><span style=\"color:#E1E4E8\">));</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> isExist </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> fs.</span><span style=\"color:#B392F0\">existsSync</span><span style=\"color:#E1E4E8\">(specFileAbsolutePath);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">isExist) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    continue</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // lowCoverageFiles.push(&#123;</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    //   filePath: filePath,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    //   fileCoverage: 0</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // &#125;);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> fileCoverage </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(report)[fileAbsolutePath].lines.pct;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (fileCoverage </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#79B8FF\"> 70</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    lowCoverageFiles.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">(&#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      filePath: filePath,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      fileCoverage: fileCoverage</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// 如果存在不符合要求的文件输出报错并异常退出，否则正常退出</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (lowCoverageFiles.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">var</span><span style=\"color:#E1E4E8\"> i </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">; i </span><span style=\"color:#F97583\">&#x3C;</span><span style=\"color:#E1E4E8\"> lowCoverageFiles.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">; i</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'❌ '</span><span style=\"color:#F97583\"> +</span><span style=\"color:#B392F0\"> colors</span><span style=\"color:#E1E4E8\">([</span><span style=\"color:#9ECBFF\">'yellow'</span><span style=\"color:#E1E4E8\">], lowCoverageFiles[i].filePath) </span><span style=\"color:#F97583\">+</span><span style=\"color:#9ECBFF\"> ' unit test coverage '</span><span style=\"color:#F97583\"> +</span><span style=\"color:#B392F0\"> colors</span><span style=\"color:#E1E4E8\">([</span><span style=\"color:#9ECBFF\">'red'</span><span style=\"color:#E1E4E8\">], lowCoverageFiles[i].fileCoverage </span><span style=\"color:#F97583\">+</span><span style=\"color:#9ECBFF\"> '%'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#9ECBFF\"> ' is less than '</span><span style=\"color:#F97583\"> +</span><span style=\"color:#B392F0\"> colors</span><span style=\"color:#E1E4E8\">([</span><span style=\"color:#9ECBFF\">'green'</span><span style=\"color:#E1E4E8\">], </span><span style=\"color:#9ECBFF\">'70%'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#9ECBFF\"> ', please add more unit test cases!'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> colors</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">keys</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">source</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> styles </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'reset'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[0m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'bright'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[1m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'grey'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[2m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'italic'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[3m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'underline'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[4m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'reverse'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[7m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'hidden'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[8m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'black'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[30m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'red'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[31m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'green'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[32m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'yellow'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[33m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'blue'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[34m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'magenta'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[35m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'cyan'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[36m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'white'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[37m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'blackBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[40m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'redBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[41m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'greenBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[42m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'yellowBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[43m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'blueBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[44m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'magentaBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[45m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'cyanBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[46m'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">    'whiteBG'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#79B8FF\">\\x1B</span><span style=\"color:#9ECBFF\">[47m'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  var</span><span style=\"color:#E1E4E8\"> values </span><span style=\"color:#F97583\">=</span><span style=\"color:#9ECBFF\"> ''</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">typeof</span><span style=\"color:#E1E4E8\"> keys </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'string'</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    values </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> styles[keys];</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  else</span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    keys.</span><span style=\"color:#B392F0\">forEach</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">function</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      values </span><span style=\"color:#F97583\">+=</span><span style=\"color:#E1E4E8\"> styles[key];</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125;);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  &#125;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#E1E4E8\"> values </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> source </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> styles[</span><span style=\"color:#9ECBFF\">'reset'</span><span style=\"color:#E1E4E8\">]</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"在package-json中添加script\">在package.json中添加script</h2>\n<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    \"scripts\"</span><span style=\"color:#E1E4E8\">: &#123;</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">        \"check-coverage\"</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"node ./scripts/check-coverage.js\"</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;</span></span></code></pre>\n<h2 id=\"husky-拦截-git-提交\">husky 拦截 git 提交</h2>\n<p>下面命令会安装和初始化husky并在项目中创建/.husky/pre-commit文件。</p>\n<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> install</span><span style=\"color:#79B8FF\"> --save-dev</span><span style=\"color:#9ECBFF\"> husky</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npx</span><span style=\"color:#9ECBFF\"> husky</span><span style=\"color:#9ECBFF\"> init</span></span></code></pre>\n<p>pre-commit 中可以添加在git提交时执行的命令。</p>\n<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># 删除之前生成的单元测试报告</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">rm</span><span style=\"color:#79B8FF\"> -rf</span><span style=\"color:#9ECBFF\"> coverage/projectName/</span><span style=\"color:#79B8FF\">*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 生成单元测试报告</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">ng</span><span style=\"color:#9ECBFF\"> test</span><span style=\"color:#79B8FF\"> --code-coverage</span><span style=\"color:#79B8FF\"> --watch=false</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># 执行node脚本检测提交的文件的单元测试覆盖率是否达标</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">npm</span><span style=\"color:#9ECBFF\"> run</span><span style=\"color:#9ECBFF\"> check-coverage</span></span></code></pre>\n<h2 id=\"总结-3\">总结</h2>\n<p>将上面的代码配置在项目中后每次执行<code>git commit</code> 命令后生成报告并检测单测覆盖率。不达标时会输出报错并阻止提交。后续可以考虑在项目的CI/CD中来检测以防止husky未安装跳过检测等问题。</p>\n","text":"单元测试作为项目中不可或缺的一部分，无论是Angular、React还是Vue都有其默认的单元测试框架，这里就不讨论该使用哪个框架以及框架的优缺点。本文聚焦于如...","permalink":"/post/check-ut-coverage","photos":[],"count_time":{"symbolsCount":"4.1k","symbolsTime":"4 mins."},"categories":[{"name":"NODE","slug":"NODE","count":1,"path":"api/categories/NODE.json"}],"tags":[{"name":"node","slug":"node","count":1,"path":"api/tags/node.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96karma%E9%85%8D%E7%BD%AE\"><span class=\"toc-text\">初始化karma配置</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#node%E8%84%9A%E6%9C%AC%E6%A3%80%E6%B5%8B%E8%A6%86%E7%9B%96%E7%8E%87\"><span class=\"toc-text\">node脚本检测覆盖率</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%9C%A8package-json%E4%B8%AD%E6%B7%BB%E5%8A%A0script\"><span class=\"toc-text\">在package.json中添加script</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#husky-%E6%8B%A6%E6%88%AA-git-%E6%8F%90%E4%BA%A4\"><span class=\"toc-text\">husky 拦截 git 提交</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E7%BB%93-3\"><span class=\"toc-text\">总结</span></a></li></ol>","author":{"name":"Kidwen","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/38277891?v=4","link":"/","description":"Frontend","socials":{"github":"https://github.com/kidwen","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"adb","uid":"26b117999aa847f72cadcbaea980685a","slug":"adb","date":"2026-02-05T10:07:57.958Z","updated":"2026-02-05T10:08:01.554Z","comments":true,"path":"api/articles/adb.json","keywords":null,"cover":"https://telegraph-image-new.vercel.app/api/cfile/AgACAgUAAyEGAASHUuUOAANpaYRM-wG2NzIJcqz5i6mAlTmKTHAAAqYRaxuvcyBUzA9u_ZtUjO4BAAMCAAN4AAM4BA","text":"这是一篇关于 ADB（Android Debug Bridge）连接的博客，可以按照从工具准备到实际连接，再到进阶无线连接的逻辑进行组织。 ADB 的安装与环境...","permalink":"/post/adb","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"TOOL","slug":"TOOL","count":11,"path":"api/categories/TOOL.json"}],"tags":[{"name":"adb","slug":"adb","count":1,"path":"api/tags/adb.json"}],"author":{"name":"Kidwen","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/38277891?v=4","link":"/","description":"Frontend","socials":{"github":"https://github.com/kidwen","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"ts 中 any、unknown、{}、object 的区别","uid":"22e810e3b4957093defc777cc7b799b3","slug":"any-unknomn","date":"2025-04-24T09:27:56.038Z","updated":"2025-04-24T09:27:56.038Z","comments":true,"path":"api/articles/any-unknomn.json","keywords":null,"cover":"https://img.kidwen.top/file/AgACAgUAAyEGAASHUuUOAAM4aAmh0qyVHG-I_eXt-6C8YEXW9Q8AAtbAMRuoQFBUpgSyfIfSRa8BAAMCAAN4AAM2BA.png","text":"在 typescript 中，any、unknown、{} 和 object 是四种不同的类型，它们在类型系统中的用途和含义各不相同。下面是它们之间的区别： a...","permalink":"/post/any-unknomn","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"TYPESCRIPT","slug":"TYPESCRIPT","count":2,"path":"api/categories/TYPESCRIPT.json"}],"tags":[{"name":"typescript","slug":"typescript","count":3,"path":"api/tags/typescript.json"}],"author":{"name":"Kidwen","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/38277891?v=4","link":"/","description":"Frontend","socials":{"github":"https://github.com/kidwen","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}