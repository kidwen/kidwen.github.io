{"title":"cloudflare work 随机获取bing图片","uid":"f95226d9f0855b378f638cf659474409","slug":"bing-rand-image","date":"2024-06-11T03:50:02.722Z","updated":"2024-06-27T03:05:31.451Z","comments":true,"path":"api/articles/bing-rand-image.json","keywords":null,"cover":"https://rand-img.kidwen.top?rand=true","content":"<p>Cloudflare Workers 是一个无服务器计算平台，允许开发人员在 Cloudflare 的边缘网络上运行 JavaScript 代码。它提供了强大的功能，适用于各种应用场景，包括动态内容生成、API 代理、负载均衡、认证和缓存管理等。</p>\n<p>本文介绍使用cloudflare work搭建一个可以随机获取bing图片的api</p>\n<h3 id=\"Cloudflare-work-代码\">Cloudflare work 代码</h3>\n<pre class=\"shiki github-dark\" style=\"background-color:#24292e;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">addEventListener</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'fetch'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">event</span><span style=\"color:#F97583\"> =></span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    event.</span><span style=\"color:#B392F0\">respondWith</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#B392F0\">handleRequest</span><span style=\"color:#E1E4E8\">(event.request));</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> handleRequest</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">request</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> url</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> URL</span><span style=\"color:#E1E4E8\">(request.url);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> params</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> url.searchParams;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 判断是否随机调用</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    let</span><span style=\"color:#E1E4E8\"> gettime;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (params.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'rand'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'true'</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        gettime </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> Math.</span><span style=\"color:#B392F0\">floor</span><span style=\"color:#E1E4E8\">(Math.</span><span style=\"color:#B392F0\">random</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">*</span><span style=\"color:#79B8FF\"> 8</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">-</span><span style=\"color:#79B8FF\"> 1</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125; </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">        // 若不为随机调用则判断是否指定日期</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        let</span><span style=\"color:#E1E4E8\"> gettimebase </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> params.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'day'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">gettimebase) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            gettime </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#125; </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            gettime </span><span style=\"color:#F97583\">=</span><span style=\"color:#B392F0\"> parseInt</span><span style=\"color:#E1E4E8\">(gettimebase, </span><span style=\"color:#79B8FF\">10</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 获取Bing Json信息</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> apiUrl</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `https://www.bing.com/HPImageArchive.aspx?format=js&#x26;idx=$&#123;</span><span style=\"color:#E1E4E8\">gettime</span><span style=\"color:#9ECBFF\">&#125;&#x26;n=1`</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(apiUrl);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> response.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 提取基础url</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imgurlbase</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> \"https://www.bing.com\"</span><span style=\"color:#F97583\"> +</span><span style=\"color:#E1E4E8\"> data.images[</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">].urlbase;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 判断是否指定图片大小</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imgsizebase</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> params.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'size'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imgsize</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> imgsizebase </span><span style=\"color:#F97583\">||</span><span style=\"color:#9ECBFF\"> \"1920x1080\"</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 建立完整url</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imgurl</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> `$&#123;</span><span style=\"color:#E1E4E8\">imgurlbase</span><span style=\"color:#9ECBFF\">&#125;_$&#123;</span><span style=\"color:#E1E4E8\">imgsize</span><span style=\"color:#9ECBFF\">&#125;.jpg`</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 获取其他信息</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imgtime</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> data.images[</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">].startdate;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imgtitle</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> data.images[</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">].copyright;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> imglink</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> data.images[</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">].copyrightlink;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // 判断是否只获取图片信息</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (params.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'info'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'true'</span><span style=\"color:#E1E4E8\">) &#123;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Response</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(&#123; title: imgtitle, url: imgurl, link: imglink, time: imgtime &#125;), &#123;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">            headers: &#123; </span><span style=\"color:#9ECBFF\">'Content-Type'</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'application/json'</span><span style=\"color:#E1E4E8\"> &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        &#125;);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125; </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">        // 若不是则跳转url</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#E1E4E8\"> Response.</span><span style=\"color:#B392F0\">redirect</span><span style=\"color:#E1E4E8\">(imgurl, </span><span style=\"color:#79B8FF\">302</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">&#125;</span></span></code></pre>\n<h3 id=\"Bing-api-参数介绍\">Bing api 参数介绍</h3>\n<p><a href=\"https://www.bing.com/HPImageArchive.aspx?format=xml&amp;cc=jp&amp;idx=0&amp;n=1&amp;video=1\">接口地址</a></p>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>性质</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>format</td>\n<td>可选</td>\n<td>取值范围 [js, xml]，接口将根据此参数返回对应的 XML 或者 JSON 格式的数据，缺省（或缺失）将默认返回 XML 文档数据格式。</td>\n</tr>\n<tr>\n<td>cc</td>\n<td>可选</td>\n<td><code>国家（含地区）代码（Country Code）的英文缩写，表示获取相应地区的必应美图（需要国外主机，国内主机请求一律返回中国区的必应美图），目前已知的可取值范围 {ar、at、au、be、br、ca、ch、cl、cn、de、dk、es、fi、fr、hk、ie、in、it、jp、kr、nl、no、nz、ph、pt、ru、se、sg、tw、uk}，对应的地区请对照此列表 → 传送门，缺省（或缺失）将自动根据请求源 IP 所在的地区返回相应地区的美图信息（划重点，并非每个地区都有属于自己独一无二的美图，未预设美图的地区将直接引用国际版 Bing 美图。另外在配合国外主机使用此参数时抓取信息时，需要使用国际版或其它地区的必应首页地址，例如“www.bing.com”，才能获取到相应“cc”地区的美图，否则一律返回中国区的美图信息。</code>国家（含地区）代码（Country Code）的英文缩写，表示获取相应地区的必应美图（需要国外主机，国内主机请求一律返回中国区的必应美图），目前已知的可取值范围 {ar、at、au、be、br、ca、ch、cl、cn、de、dk、es、fi、fr、hk、ie、in、it、jp、kr、nl、no、nz、ph、pt、ru、se、sg、tw、uk}</td>\n</tr>\n<tr>\n<td>idx</td>\n<td>可选</td>\n<td><code>取值范围 [-1, 7] 之间的整数，表示 {明天、今天、昨天、前天、三天前、依此类推……} 的图片，缺省（或缺失）则默认为“0”，表示今天的美图。</code></td>\n</tr>\n<tr>\n<td>n</td>\n<td>必选</td>\n<td><code>缺省（或缺失）将返回 null（空值），导致无法获取美图信息。取值范围是[1,8]之间的整数，表示从“idx”指定的日期开始往前推共“n”张美图信息。</code></td>\n</tr>\n<tr>\n<td>video</td>\n<td>可选</td>\n<td><code>取值范围 [0, 1]，缺省（或缺失）则默认为“0”，则不返回相应的流媒体信息（音频/视频），并不是每天都有流媒体视音频的，需要根据返回的字段键值对做判断。</code></td>\n</tr>\n</tbody>\n</table>\n","text":"Cloudflare Workers 是一个无服务器计算平台，允许开发人员在 Cloudflare 的边缘网络上运行 JavaScript 代码。它提供了强大的...","permalink":"/post/bing-rand-image","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"TOOL","slug":"TOOL","count":11,"path":"api/categories/TOOL.json"}],"tags":[{"name":"cloudflare","slug":"cloudflare","count":1,"path":"api/tags/cloudflare.json"},{"name":"bing","slug":"bing","count":1,"path":"api/tags/bing.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Cloudflare-work-%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">Cloudflare work 代码</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#Bing-api-%E5%8F%82%E6%95%B0%E4%BB%8B%E7%BB%8D\"><span class=\"toc-text\">Bing api 参数介绍</span></a></li></ol>","author":{"name":"Kidwen","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/38277891?v=4","link":"/","description":"Frontend","socials":{"github":"https://github.com/kidwen","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"google map directions","uid":"472154ff4d678918f357bc4ca8cdd7e6","slug":"google-map-directions","date":"2024-07-03T08:36:04.918Z","updated":"2024-07-03T01:36:01.950Z","comments":true,"path":"api/articles/google-map-directions.json","keywords":null,"cover":"https://img.kidwen.top/file/b56d73d6c92ace32249a6.png","text":"本文介绍通过 google map directions api 获取导航路径并绘制到google地图上，支持多条路径绘制。精准时间也有一些限制需要注意。 通过...","permalink":"/post/google-map-directions","photos":[],"count_time":{"symbolsCount":"24k","symbolsTime":"22 mins."},"categories":[],"tags":[{"name":"google map","slug":"google-map","count":1,"path":"api/tags/google-map.json"}],"author":{"name":"Kidwen","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/38277891?v=4","link":"/","description":"Frontend","socials":{"github":"https://github.com/kidwen","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"一元加运算符","uid":"b28fd708a6b0cdabb2826b2e3d8e93bc","slug":"unary-plus","date":"2024-04-25T05:48:28.764Z","updated":"2024-06-14T02:40:14.406Z","comments":true,"path":"api/articles/unary-plus.json","keywords":null,"cover":"https://img.kidwen.top/file/dd54dea948e128b8fea23.png","text":"一元加（+）对其操作数进行强制数字转换，对于大多数没有 @@toPrimitive 的对象，这意味着调用其 valueOf()。但是，如果对象没有自定义的 va...","permalink":"/post/unary-plus","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"JAVASCRIPT","slug":"JAVASCRIPT","count":3,"path":"api/categories/JAVASCRIPT.json"}],"tags":[{"name":"javascript","slug":"javascript","count":3,"path":"api/tags/javascript.json"}],"author":{"name":"Kidwen","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/38277891?v=4","link":"/","description":"Frontend","socials":{"github":"https://github.com/kidwen","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}